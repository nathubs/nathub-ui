<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>增强功能 | NATHub</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/docs/favicon.ico">
    <meta name="description" content="内网穿透，如此简单">
    <link rel="preload" href="/docs/assets/css/0.styles.f54e6fe5.css" as="style"><link rel="preload" href="/docs/assets/js/app.d18d5aad.js" as="script"><link rel="preload" href="/docs/assets/js/2.8b8b71cd.js" as="script"><link rel="preload" href="/docs/assets/js/21.6c1018bc.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f44ed60e.js"><link rel="prefetch" href="/docs/assets/js/11.4947db47.js"><link rel="prefetch" href="/docs/assets/js/12.88c04df4.js"><link rel="prefetch" href="/docs/assets/js/13.7016b792.js"><link rel="prefetch" href="/docs/assets/js/14.0a99e4e1.js"><link rel="prefetch" href="/docs/assets/js/15.6f2241d2.js"><link rel="prefetch" href="/docs/assets/js/16.adceab74.js"><link rel="prefetch" href="/docs/assets/js/17.153f99e7.js"><link rel="prefetch" href="/docs/assets/js/18.d098ee44.js"><link rel="prefetch" href="/docs/assets/js/19.55c4bab3.js"><link rel="prefetch" href="/docs/assets/js/20.7837917e.js"><link rel="prefetch" href="/docs/assets/js/22.11862d06.js"><link rel="prefetch" href="/docs/assets/js/23.55e7b9bf.js"><link rel="prefetch" href="/docs/assets/js/24.c4feea7f.js"><link rel="prefetch" href="/docs/assets/js/25.8d3b9fe9.js"><link rel="prefetch" href="/docs/assets/js/26.41618cb6.js"><link rel="prefetch" href="/docs/assets/js/27.95b6238b.js"><link rel="prefetch" href="/docs/assets/js/28.b66e34df.js"><link rel="prefetch" href="/docs/assets/js/3.66c75114.js"><link rel="prefetch" href="/docs/assets/js/4.a730639a.js"><link rel="prefetch" href="/docs/assets/js/5.a3185cee.js"><link rel="prefetch" href="/docs/assets/js/6.03eb9b05.js"><link rel="prefetch" href="/docs/assets/js/7.1f86e406.js"><link rel="prefetch" href="/docs/assets/js/8.1eb12618.js"><link rel="prefetch" href="/docs/assets/js/9.0b2b3709.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.f54e6fe5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">NATHub</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/docs/documents/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://nathubs.github.io/nathubs" target="_blank" rel="noopener noreferrer" class="repo-link">
    控制台
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/docs/documents/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://nathubs.github.io/nathubs" target="_blank" rel="noopener noreferrer" class="repo-link">
    控制台
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>增强功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/documents/nps_extend.html#使用https" class="sidebar-link">使用https</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#与nginx配合" class="sidebar-link">与nginx配合</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#web管理使用https" class="sidebar-link">web管理使用https</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#web使用caddy代理" class="sidebar-link">web使用Caddy代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#关闭代理" class="sidebar-link">关闭代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#流量数据持久化" class="sidebar-link">流量数据持久化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#系统信息显示" class="sidebar-link">系统信息显示</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#自定义客户端连接密钥" class="sidebar-link">自定义客户端连接密钥</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#关闭公钥访问" class="sidebar-link">关闭公钥访问</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#关闭web管理" class="sidebar-link">关闭web管理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#服务端多用户登陆" class="sidebar-link">服务端多用户登陆</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#用户注册功能" class="sidebar-link">用户注册功能</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#监听指定ip" class="sidebar-link">监听指定ip</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/nps_extend.html#代理到服务端本地" class="sidebar-link">代理到服务端本地</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="增强功能"><a href="#增强功能" class="header-anchor">#</a> 增强功能</h1> <h2 id="使用https"><a href="#使用https" class="header-anchor">#</a> 使用https</h2> <p><strong>方式一：</strong> 类似于nginx实现https的处理</p> <p>在配置文件中将https_proxy_port设置为443或者其他你想配置的端口，和在web中对应域名编辑中设置对应的证书路径，将<code>https_just_proxy</code>设置为false，然后就和http代理一样了</p> <p><strong>此外：</strong> 可以在<code>nps.conf</code>中设置一个默认的https配置，当遇到未在web中设置https证书的域名解析时，将自动使用默认证书，另还有一种情况就是对于某些请求的clienthello不携带sni扩展信息，nps也将自动使用默认证书</p> <p><strong>方式二：</strong> 在内网对应服务器上设置https</p> <p>在<code>nps.conf</code>中将<code>https_just_proxy</code>设置为true，并且打开<code>https_proxy_port</code>端口，然后nps将直接转发https请求到内网服务器上，由内网服务器进行https处理</p> <h2 id="与nginx配合"><a href="#与nginx配合" class="header-anchor">#</a> 与nginx配合</h2> <p>有时候我们还需要在云服务器上运行nginx来保证静态文件缓存等，本代理可和nginx配合使用，在配置文件中将httpProxyPort设置为非80端口，并在nginx中配置代理，例如httpProxyPort为8010时</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen 80;
    server_name *.proxy.com;
    location / {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8010;
    }
}
</code></pre></div><p>如需使用https也可在nginx监听443端口并配置ssl，并将本代理的httpsProxyPort设置为空关闭https即可，例如httpProxyPort为8020时</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen 443;
    server_name *.proxy.com;
    ssl on;
    ssl_certificate  certificate.crt;
    ssl_certificate_key private.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    location / {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8020;
    }
}
</code></pre></div><h2 id="web管理使用https"><a href="#web管理使用https" class="header-anchor">#</a> web管理使用https</h2> <p>如果web管理需要使用https，可以在配置文件<code>nps.conf</code>中设置<code>web_open_ssl=true</code>，并配置<code>web_cert_file</code>和<code>web_key_file</code></p> <h2 id="web使用caddy代理"><a href="#web使用caddy代理" class="header-anchor">#</a> web使用Caddy代理</h2> <p>如果将web配置到Caddy代理,实现子路径访问nps,可以这样配置.</p> <p>假设我们想通过 <code>http://caddy_ip:caddy_port/nps</code> 来访问后台, Caddyfile 这样配置:</p> <div class="language-Caddyfile extra-class"><pre class="language-text"><code>caddy_ip:caddy_port/nps {
  ##server_ip 为 nps 服务器IP
  ##web_port 为 nps 后台端口
  proxy / http://server_ip:web_port/nps {
	transparent
  }
}
</code></pre></div><p>nps.conf 修改 <code>web_base_url</code> 为 <code>/nps</code> 即可</p> <div class="language- extra-class"><pre class="language-text"><code>web_base_url=/nps
</code></pre></div><h2 id="关闭代理"><a href="#关闭代理" class="header-anchor">#</a> 关闭代理</h2> <p>如需关闭http代理可在配置文件中将http_proxy_port设置为空，如需关闭https代理可在配置文件中将https_proxy_port设置为空。</p> <h2 id="流量数据持久化"><a href="#流量数据持久化" class="header-anchor">#</a> 流量数据持久化</h2> <p>服务端支持将流量数据持久化，默认情况下是关闭的，如果有需求可以设置<code>nps.conf</code>中的<code>flow_store_interval</code>参数，单位为分钟</p> <p><strong>注意：</strong> nps不会持久化通过公钥连接的客户端</p> <h2 id="系统信息显示"><a href="#系统信息显示" class="header-anchor">#</a> 系统信息显示</h2> <p>nps服务端支持在web上显示和统计服务器的相关信息，但默认一些统计图表是关闭的，如需开启请在<code>nps.conf</code>中设置<code>system_info_display=true</code></p> <h2 id="自定义客户端连接密钥"><a href="#自定义客户端连接密钥" class="header-anchor">#</a> 自定义客户端连接密钥</h2> <p>web上可以自定义客户端连接的密钥，但是必须具有唯一性</p> <h2 id="关闭公钥访问"><a href="#关闭公钥访问" class="header-anchor">#</a> 关闭公钥访问</h2> <p>可以将<code>nps.conf</code>中的<code>public_vkey</code>设置为空或者删除</p> <h2 id="关闭web管理"><a href="#关闭web管理" class="header-anchor">#</a> 关闭web管理</h2> <p>可以将<code>nps.conf</code>中的<code>web_port</code>设置为空或者删除</p> <h2 id="服务端多用户登陆"><a href="#服务端多用户登陆" class="header-anchor">#</a> 服务端多用户登陆</h2> <p>如果将<code>nps.conf</code>中的<code>allow_user_login</code>设置为true,服务端web将支持多用户登陆，登陆用户名为user，默认密码为每个客户端的验证密钥，登陆后可以进入客户端编辑修改web登陆的用户名和密码，默认该功能是关闭的。</p> <h2 id="用户注册功能"><a href="#用户注册功能" class="header-anchor">#</a> 用户注册功能</h2> <p>nps服务端支持用户注册功能，可将<code>nps.conf</code>中的<code>allow_user_register</code>设置为true，开启后登陆页将会有有注册功能，</p> <h2 id="监听指定ip"><a href="#监听指定ip" class="header-anchor">#</a> 监听指定ip</h2> <p>nps支持每个隧道监听不同的服务端端口,在<code>nps.conf</code>中设置<code>allow_multi_ip=true</code>后，可在web中控制，或者npc配置文件中(可忽略，默认为0.0.0.0)</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token constant">server_ip</span><span class="token attr-value"><span class="token punctuation">=</span>xxx</span>
</code></pre></div><h2 id="代理到服务端本地"><a href="#代理到服务端本地" class="header-anchor">#</a> 代理到服务端本地</h2> <p>在使用nps监听80或者443端口时，默认是将所有的请求都会转发到内网上，但有时候我们的nps服务器的上一些服务也需要使用这两个端口，nps提供类似于<code>nginx</code> <code>proxy_pass</code> 的功能，支持将代理到服务器本地，该功能支持域名解析，tcp、udp隧道，默认关闭。</p> <p><strong>即：</strong> 假设在nps的vps服务器上有一个服务使用5000端口，这时候nps占用了80端口和443，我们想能使用一个域名通过http(s)访问到5000的服务。</p> <p><strong>使用方式：</strong> 在<code>nps.conf</code>中设置<code>allow_local_proxy=true</code>，然后在web上设置想转发的隧道或者域名然后选择转发到本地选项即可成功。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.d18d5aad.js" defer></script><script src="/docs/assets/js/2.8b8b71cd.js" defer></script><script src="/docs/assets/js/21.6c1018bc.js" defer></script>
  </body>
</html>
