<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用示例 | NATHub</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/docs/favicon.ico">
    <meta name="description" content="内网穿透，如此简单">
    <link rel="preload" href="/docs/assets/css/0.styles.f54e6fe5.css" as="style"><link rel="preload" href="/docs/assets/js/app.246df4ea.js" as="script"><link rel="preload" href="/docs/assets/js/2.8b8b71cd.js" as="script"><link rel="preload" href="/docs/assets/js/14.0a99e4e1.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.bb16fc20.js"><link rel="prefetch" href="/docs/assets/js/11.4947db47.js"><link rel="prefetch" href="/docs/assets/js/12.88c04df4.js"><link rel="prefetch" href="/docs/assets/js/13.7016b792.js"><link rel="prefetch" href="/docs/assets/js/15.6f2241d2.js"><link rel="prefetch" href="/docs/assets/js/16.808dd534.js"><link rel="prefetch" href="/docs/assets/js/17.0fd550ea.js"><link rel="prefetch" href="/docs/assets/js/18.d098ee44.js"><link rel="prefetch" href="/docs/assets/js/19.55c4bab3.js"><link rel="prefetch" href="/docs/assets/js/20.7837917e.js"><link rel="prefetch" href="/docs/assets/js/21.6c1018bc.js"><link rel="prefetch" href="/docs/assets/js/22.11862d06.js"><link rel="prefetch" href="/docs/assets/js/23.55e7b9bf.js"><link rel="prefetch" href="/docs/assets/js/24.c4feea7f.js"><link rel="prefetch" href="/docs/assets/js/25.8d3b9fe9.js"><link rel="prefetch" href="/docs/assets/js/26.03ce657f.js"><link rel="prefetch" href="/docs/assets/js/27.a89a2094.js"><link rel="prefetch" href="/docs/assets/js/28.d18fb160.js"><link rel="prefetch" href="/docs/assets/js/3.66c75114.js"><link rel="prefetch" href="/docs/assets/js/4.a730639a.js"><link rel="prefetch" href="/docs/assets/js/5.f13c8962.js"><link rel="prefetch" href="/docs/assets/js/6.80a51cfc.js"><link rel="prefetch" href="/docs/assets/js/7.fae278e3.js"><link rel="prefetch" href="/docs/assets/js/8.f78c9677.js"><link rel="prefetch" href="/docs/assets/js/9.9219e583.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.f54e6fe5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">NATHub</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  文档
</a></div> <a href="https://nathubs.github.io/nathubs" target="_blank" rel="noopener noreferrer" class="repo-link">
    控制台
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  文档
</a></div> <a href="https://nathubs.github.io/nathubs" target="_blank" rel="noopener noreferrer" class="repo-link">
    控制台
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>使用示例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/documents/example.html#统一准备工作（必做）" class="sidebar-link">统一准备工作（必做）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#域名解析" class="sidebar-link">域名解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#tcp隧道" class="sidebar-link">tcp隧道</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#udp隧道" class="sidebar-link">udp隧道</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#socks5代理" class="sidebar-link">socks5代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#http正向代理" class="sidebar-link">http正向代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#私密代理" class="sidebar-link">私密代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/documents/example.html#p2p服务" class="sidebar-link">p2p服务</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用示例"><a href="#使用示例" class="header-anchor">#</a> 使用示例</h1> <h2 id="统一准备工作（必做）"><a href="#统一准备工作（必做）" class="header-anchor">#</a> 统一准备工作（必做）</h2> <ul><li>开启服务端，假设公网服务器ip为1.1.1.1，配置文件中<code>bridge_port</code>为8024，配置文件中<code>web_port</code>为8080</li> <li>访问1.1.1.1:8080</li> <li>在客户端管理中创建一个客户端，记录下验证密钥</li> <li>内网客户端运行（windows使用cmd运行加.exe）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>./npc -server<span class="token operator">=</span><span class="token number">1.1</span>.1.1:8024 -vkey<span class="token operator">=</span>客户端的密钥
</code></pre></div><p><strong>注意：运行服务端后，请确保能从客户端设备上正常访问配置文件中所配置的<code>bridge_port</code>端口，telnet，netcat这类的来检查</strong></p> <h2 id="域名解析"><a href="#域名解析" class="header-anchor">#</a> 域名解析</h2> <p><strong>适用范围：</strong> 小程序开发、微信公众号开发、产品演示</p> <p><strong>注意：域名解析模式为http反向代理，不是dns服务器，在web上能够轻松灵活配置</strong></p> <p><strong>假设场景：</strong></p> <ul><li>有一个域名proxy.com，有一台公网机器ip为1.1.1.1</li> <li>两个内网开发站点127.0.0.1:81，127.0.0.1:82</li> <li>想通过（http|https://）a.proxy.com访问127.0.0.1:81，通过（http|https://）b.proxy.com访问127.0.0.1:82</li></ul> <p><strong>使用步骤</strong></p> <ul><li>将*.proxy.com解析到公网服务器1.1.1.1</li> <li>点击刚才创建的客户端的域名管理，添加两条规则规则：1、域名：<code>a.proxy.com</code>，内网目标：<code>127.0.0.1:81</code>，2、域名：<code>b.proxy.com</code>，内网目标：<code>127.0.0.1:82</code></li></ul> <p>现在访问（http|https://）<code>a.proxy.com</code>，<code>b.proxy.com</code>即可成功</p> <p><strong>https:</strong> 如需使用https请进行相关配置，详见 <a href="/nps_extend?id=%E4%BD%BF%E7%94%A8https">使用https</a></p> <h2 id="tcp隧道"><a href="#tcp隧道" class="header-anchor">#</a> tcp隧道</h2> <p><strong>适用范围：</strong>  ssh、远程桌面等tcp连接场景</p> <p><strong>假设场景：</strong>
想通过访问公网服务器1.1.1.1的8001端口，连接内网机器10.1.50.101的22端口，实现ssh连接</p> <p><strong>使用步骤</strong></p> <ul><li>在刚才创建的客户端隧道管理中添加一条tcp隧道，填写监听的端口（8001）、内网目标ip和目标端口（10.1.50.101:22），保存。</li> <li>访问公网服务器ip（1.1.1.1）,填写的监听端口(8001)，相当于访问内网ip(10.1.50.101):目标端口(22)，例如：<code>ssh -p 8001 root@1.1.1.1</code></li></ul> <h2 id="udp隧道"><a href="#udp隧道" class="header-anchor">#</a> udp隧道</h2> <p><strong>适用范围：</strong>  内网dns解析等udp连接场景</p> <p><strong>假设场景：</strong>
内网有一台dns（10.1.50.102:53），在非内网环境下想使用该dns，公网服务器为1.1.1.1</p> <p><strong>使用步骤</strong></p> <ul><li>在刚才创建的客户端的隧道管理中添加一条udp隧道，填写监听的端口（53）、内网目标ip和目标端口（10.1.50.102:53），保存。</li> <li>修改需要使用的dns地址为1.1.1.1，则相当于使用10.1.50.102作为dns服务器</li></ul> <h2 id="socks5代理"><a href="#socks5代理" class="header-anchor">#</a> socks5代理</h2> <p><strong>适用范围：</strong>  在外网环境下如同使用vpn一样访问内网设备或者资源</p> <p><strong>假设场景：</strong>
想将公网服务器1.1.1.1的8003端口作为socks5代理，达到访问内网任意设备或者资源的效果</p> <p><strong>使用步骤</strong></p> <ul><li>在刚才创建的客户端隧道管理中添加一条socks5代理，填写监听的端口（8003），保存。</li> <li>在外网环境的本机配置socks5代理(例如使用proxifier进行全局代理)，ip为公网服务器ip（1.1.1.1），端口为填写的监听端口(8003)，即可畅享内网了</li></ul> <p><strong>注意</strong>
经过socks5代理，当收到socks5数据包时socket已经是accept状态。表现是扫描端口全open，建立连接后短时间关闭。若想同内网表现一致，建议远程连接一台设备。</p> <h2 id="http正向代理"><a href="#http正向代理" class="header-anchor">#</a> http正向代理</h2> <p><strong>适用范围：</strong>  在外网环境下使用http正向代理访问内网站点</p> <p><strong>假设场景：</strong>
想将公网服务器1.1.1.1的8004端口作为http代理，访问内网网站</p> <p><strong>使用步骤</strong></p> <ul><li>在刚才创建的客户端隧道管理中添加一条http代理，填写监听的端口（8004），保存。</li> <li>在外网环境的本机配置http代理，ip为公网服务器ip（1.1.1.1），端口为填写的监听端口(8004)，即可访问了</li></ul> <p><strong>注意：对于私密代理与p2p，除了统一配置的客户端和服务端，还需要一个客户端作为访问端提供一个端口来访问</strong></p> <h2 id="私密代理"><a href="#私密代理" class="header-anchor">#</a> 私密代理</h2> <p><strong>适用范围：</strong>  无需占用多余的端口、安全性要求较高可以防止其他人连接的tcp服务，例如ssh。</p> <p><strong>假设场景：</strong>
无需新增多的端口实现访问内网服务器10.1.50.2的22端口</p> <p><strong>使用步骤</strong></p> <ul><li>在刚才创建的客户端中添加一条私密代理，并设置唯一密钥secrettest和内网目标10.1.50.2:22</li> <li>在需要连接ssh的机器上以执行命令</li></ul> <div class="language- extra-class"><pre class="language-text"><code>./npc -server=1.1.1.1:8024 -vkey=vkey -type=tcp -password=secrettest -local_type=secret
</code></pre></div><p>如需指定本地端口可加参数<code>-local_port=xx</code>，默认为2000</p> <p><strong>注意：</strong> password为web管理上添加的唯一密钥，具体命令可查看web管理上的命令提示</p> <p>假设10.1.50.2用户名为root，现在执行<code>ssh -p 2000 root@127.0.0.1</code>即可访问ssh</p> <h2 id="p2p服务"><a href="#p2p服务" class="header-anchor">#</a> p2p服务</h2> <p><strong>适用范围：</strong>  大流量传输场景，流量不经过公网服务器，但是由于p2p穿透和nat类型关系较大，不保证100%成功，支持大部分nat类型。<a href="/npc_extend?id=nat%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%B5%8B">nat类型检测</a></p> <p><strong>假设场景：</strong></p> <p>想通过访问使用端机器（访问端，也就是本机）的2000端口----&gt;访问到内网机器 10.2.50.2的22端口</p> <p><strong>使用步骤</strong></p> <ul><li>在<code>nps.conf</code>中设置<code>p2p_ip</code>（nps服务器ip）和<code>p2p_port</code>（nps服务器udp端口）</li></ul> <blockquote><p>注：若 <code>p2p_port</code> 设置为6000，请在防火墙开放6000~6002(额外添加2个端口)udp端口</p></blockquote> <ul><li>在刚才刚才创建的客户端中添加一条p2p代理，并设置唯一密钥p2pssh</li> <li>在使用端机器（本机）执行命令</li></ul> <div class="language- extra-class"><pre class="language-text"><code>./npc -server=1.1.1.1:8024 -vkey=123 -password=p2pssh -target=10.2.50.2:22
</code></pre></div><p>如需指定本地端口可加参数<code>-local_port=xx</code>，默认为2000</p> <p><strong>注意：</strong> password为web管理上添加的唯一密钥，具体命令可查看web管理上的命令提示</p> <p>假设内网机器为10.2.50.2的ssh用户名为root，现在在本机上执行<code>ssh -p 2000 root@127.0.0.1</code>即可访问机器2的ssh，如果是网站在浏览器访问127.0.0.1:2000端口即可。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.246df4ea.js" defer></script><script src="/docs/assets/js/2.8b8b71cd.js" defer></script><script src="/docs/assets/js/14.0a99e4e1.js" defer></script>
  </body>
</html>
